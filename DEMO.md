# Демонстрационный сценарий (DEMO.md)

## Цель сценария
Сценарий демонстрирует решение классической проблемы бэкенд-разработки: **оптимизацию медленного SQL-запроса**. 
Мы покажем, как AI-агент с помощью сервера `DevBoost` самостоятельно находит узкое место (Seq Scan) в таблице на 100 000 записей и предлагает готовый DDL-скрипт для создания недостающего индекса. Это доказывает реальную продуктовую пользу связки двух реализованных инструментов: `explain_query` и `suggest_index`.

## Предусловия
1. Вы находитесь в корне репозитория, перешли в папку `demo_project/` и с помощью Docker Compose запустили тестовую БД + контейнер MCP-сервера:
   ```bash
   cd demo_project
   docker-compose up -d --build
   ```
   Дождитесь запуска (статус контейнера `db` должен быть `healthy`).
2. Сервер готов к работе, URL MCP: `http://localhost:8000/mcp`
3. Открыт официальный MCP Inspector в браузере. Вы можете запустить его командой:
   ```bash
   npx -y @modelcontextprotocol/inspector SSE http://localhost:8000/mcp
   ```

## Шаги проверки

В новой открывшейся вкладке Inspector (раздел Chat) отправьте ИИ-агенту следующий промпт:

> "В базе данных `testdb` тормозит поиск пользователей по email. Используй инструмент `explain_query` для анализа запроса: `SELECT * FROM users WHERE email = 'target@mcp.test'`. Скажи мне, какое время выполнения и есть ли там Seq Scan. Если есть, вызови инструмент `suggest_index` для таблицы `users`, посмотри текущие индексы и сгенерируй для меня SQL-команду CREATE INDEX, чтобы исправить проблему."

**Какие инструменты (tools) выберет агент и какие аргументы передаст:**
1. Агент вызовет `explain_query` с аргументом `query: "SELECT * FROM users WHERE email = 'target@mcp.test'"`.
2. Прочитав полученный ответ, агент вызовет `suggest_index` с аргументом `tables: ["users"]`.
3. Опираясь на данные от сервера, агент сформирует итоговый ответ для пользователя.

## Ожидаемый результат
Успешное прохождение сценария характеризуется следующими признаками:
1. Агент находит узкое место: сообщает, что база делает полное сканирование (Seq Scan), так как в таблице 100 000 строк.
2. Агент проверяет наличие существующих индексов и убеждается, что индекса по `email` нет.
3. В чате сгенерирован готовый к применению скорректированный SQL-код: `CREATE INDEX idx_users_email ON users(email);`.

## Типичные проблемы / troubleshooting

*   **Ошибка соединения базы данных (Connection Refused внутри агента):**
    Проверьте, что вы находитесь именно в папке `demo_project/` и выполнили `docker-compose up -d`. Убедитесь, что контейнер базы данных находится в состоянии `healthy` (посмотреть можно командой `docker ps`).
*   **Inspector не подключается к серверу (Окно не открывается или висит Connecting):**
    Убедитесь, что вы выбрали тип подключения **SSE** и вставили точный URL: `http://localhost:8000/mcp`. Для быстрой проверки работоспособности самого контейнера выполните: `curl http://localhost:8000/health`. Контейнер должен отдать `{"status":"ok"}`.
*   **Сценарий не проходит (команда npx not found):**
    Убедитесь, что у вас установлен `Node.js` (npm/npx), так как графический UI Inspector запускается через экосистему Node.

---
*По завершении тестирования вы можете остановить стенд командой `docker-compose down -v` внутри папки `demo_project`.*
